package klustair

import (
	"time"

	"github.com/google/uuid"
	"github.com/klustair/klustair-go/pkg/trivyscanner"
)

type Vulnerability struct {
	Uid              string            `json:"uid"`
	ReportUid        string            `json:"report_uid"`
	ImageUid         string            `json:"image_uid"`
	TargetUid        string            `json:"target_uid"`
	VulnerabilityID  string            `json:"VulnerabilityID"`
	PkgName          string            `json:"pkg_name"`
	Title            string            `json:"Title"`
	Description      string            `json:"Description"`
	InstalledVersion string            `json:"InstalledVersion"`
	FixedVersion     string            `json:"FixedVersion"`
	SeveritySource   string            `json:"SeveritySource"`
	Severity         string            `json:"Severity"`
	LastModifiedDate *time.Time        `json:"LastModifiedDate"`
	PublishedDate    *time.Time        `json:"PublishedDate"`
	References       []string          `json:"Links"` //TODO may not work
	CVSS             trivyscanner.Cvss `json:"CVSS"`
	CweIDs           []string          `json:"CweIDs"`
}

func NewVulnerability(reportUid string, imageUid string, targetUid string) *Vulnerability {
	v := new(Vulnerability)
	v.Uid = uuid.New().String()
	v.ReportUid = reportUid
	v.ImageUid = imageUid
	v.TargetUid = targetUid
	return v
}
